<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>molnar machine inspo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
    </style>
</head>
<body>
<div id="root"></div>
<script>
/*
  Vera Molnar â€” Machine Imaginaire

  Combining several of her key concepts:
  - Hypertransformation: concentric squares that progressively deform
  - 1% disorder: a controlled amount of randomness introduced into strict geometric systems
  - Structure de Quadrilateres: grids of squares that bend, shift, overlap
  - Plotter aesthetic: thin precise lines on paper, sprocket holes, JOB stamps

  "My life is in squares, triangles, lines. I am mad about lines."
*/

function mulberry32(a) {
  return function () {
    a |= 0;
    a = (a + 0x6d2b79f5) | 0;
    var t = Math.imul(a ^ (a >>> 15), 1 | a);
    t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

function drawConcentricSquares(ctx, cx, cy, size, layers, disorder, rng, color, lineWidth) {
  ctx.strokeStyle = color;
  ctx.lineWidth = lineWidth;
  for (let i = 0; i < layers; i++) {
    const t = i / layers;
    const s = size * (1 - t * 0.85);
    const half = s / 2;
    const d = disorder * s * 0.5;
    const corners = [
      [cx - half + rng() * d - d / 2, cy - half + rng() * d - d / 2],
      [cx + half + rng() * d - d / 2, cy - half + rng() * d - d / 2],
      [cx + half + rng() * d - d / 2, cy + half + rng() * d - d / 2],
      [cx - half + rng() * d - d / 2, cy + half + rng() * d - d / 2],
    ];
    ctx.beginPath();
    ctx.moveTo(corners[0][0], corners[0][1]);
    ctx.lineTo(corners[1][0], corners[1][1]);
    ctx.lineTo(corners[2][0], corners[2][1]);
    ctx.lineTo(corners[3][0], corners[3][1]);
    ctx.closePath();
    ctx.stroke();
  }
}

function drawGridOfSquares(ctx, ox, oy, gridW, gridH, cols, rows, disorder, rng, color, lineWidth) {
  const cellW = gridW / cols;
  const cellH = gridH / rows;
  const inset = Math.min(cellW, cellH) * 0.12;
  ctx.strokeStyle = color;
  ctx.lineWidth = lineWidth;
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      const cx = ox + col * cellW + cellW / 2;
      const cy = oy + row * cellH + cellH / 2;
      const half = (Math.min(cellW, cellH) - inset * 2) / 2;
      const d = disorder * half * 1.2;
      const corners = [
        [cx - half + rng() * d - d / 2, cy - half + rng() * d - d / 2],
        [cx + half + rng() * d - d / 2, cy - half + rng() * d - d / 2],
        [cx + half + rng() * d - d / 2, cy + half + rng() * d - d / 2],
        [cx - half + rng() * d - d / 2, cy + half + rng() * d - d / 2],
      ];
      ctx.beginPath();
      ctx.moveTo(corners[0][0], corners[0][1]);
      ctx.lineTo(corners[1][0], corners[1][1]);
      ctx.lineTo(corners[2][0], corners[2][1]);
      ctx.lineTo(corners[3][0], corners[3][1]);
      ctx.closePath();
      ctx.stroke();
    }
  }
}

function drawTransformationStrip(ctx, ox, oy, width, height, steps, rng, color, lineWidth) {
  const stepW = width / steps;
  const layers = 12;
  for (let s = 0; s < steps; s++) {
    const t = s / (steps - 1);
    const disorder = t * 0.6;
    const cx = ox + s * stepW + stepW / 2;
    const cy = oy + height / 2;
    const size = Math.min(stepW * 0.85, height * 0.85);
    drawConcentricSquares(ctx, cx, cy, size, layers, disorder, rng, color, lineWidth);
  }
}

// --- State ---
let disorder = 1;
let seed = 42;
let composition = 0;
let colorMode = 0;
let isAnimating = false;
let animFrame = null;

const COLORS = [
  ["#1a1a1a"],
  ["#1a3a6a"],
  ["#1a1a1a", "#8b2020"],
];
const compNames = ["Hypertransformation", "Structure de Quadrilat\u00e8res", "Transformation", "Champ Dense"];

function drawScene() {
  const canvas = document.getElementById("mainCanvas");
  if (!canvas) return;
  const ctx = canvas.getContext("2d");
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  ctx.scale(dpr, dpr);
  const w = rect.width;
  const h = rect.height;

  ctx.fillStyle = "#FAF8F3";
  ctx.fillRect(0, 0, w, h);

  const rngTex = mulberry32(999);
  ctx.fillStyle = "rgba(0,0,0,0.008)";
  for (let i = 0; i < 800; i++) {
    ctx.fillRect(rngTex() * w, rngTex() * h, 1, 1);
  }

  ctx.fillStyle = "rgba(0,0,0,0.04)";
  const sprocketGap = 18;
  for (let y = sprocketGap; y < h; y += sprocketGap) {
    ctx.beginPath(); ctx.arc(10, y, 2.5, 0, Math.PI * 2); ctx.fill();
    ctx.beginPath(); ctx.arc(w - 10, y, 2.5, 0, Math.PI * 2); ctx.fill();
  }

  ctx.setLineDash([2, 3]);
  ctx.strokeStyle = "rgba(0,0,0,0.06)";
  ctx.lineWidth = 0.5;
  ctx.beginPath(); ctx.moveTo(22, 0); ctx.lineTo(22, h); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(w - 22, 0); ctx.lineTo(w - 22, h); ctx.stroke();
  ctx.setLineDash([]);

  ctx.fillStyle = "rgba(0,0,0,0.08)";
  ctx.font = '9px "Courier New", "Courier", monospace';
  ctx.textAlign = "left";
  const date = new Date();
  ctx.fillText("JOB FROM MOLNAR  " + date.toISOString().slice(0, 10) + "  SEED:" + seed + "  DISORDER:" + disorder + "%", 32, 14);

  const rng = mulberry32(seed);
  const colors = COLORS[colorMode];
  const lw = 0.8;
  const pad = 48;
  const drawW = w - pad * 2;
  const drawH = h - pad * 2 - 20;
  const disorderVal = disorder / 100;

  if (composition === 0) {
    const cols = 4, rows = 3;
    const cellW = drawW / cols, cellH = drawH / rows;
    for (let row = 0; row < rows; row++) {
      for (let col = 0; col < cols; col++) {
        const idx = row * cols + col;
        const t = idx / (cols * rows - 1);
        const localDisorder = disorderVal * t * 3;
        const cx = pad + col * cellW + cellW / 2;
        const cy = pad + 20 + row * cellH + cellH / 2;
        const size = Math.min(cellW, cellH) * 0.82;
        const color = colors[idx % colors.length];
        drawConcentricSquares(ctx, cx, cy, size, 14, localDisorder, rng, color, lw);
      }
    }
  } else if (composition === 1) {
    drawGridOfSquares(ctx, pad, pad + 20, drawW, drawH, 12, 10, disorderVal * 0.8, rng, colors[0], lw);
  } else if (composition === 2) {
    const stripH = drawH * 0.25, mainH = drawH * 0.65, gap = drawH * 0.1;
    drawTransformationStrip(ctx, pad, pad + 20, drawW, stripH, 8, rng, colors[0], lw);
    const cx = pad + drawW / 2;
    const cy = pad + 20 + stripH + gap + mainH / 2;
    const size = Math.min(drawW, mainH) * 0.85;
    drawConcentricSquares(ctx, cx, cy, size, 20, disorderVal * 1.5, rng, colors[0], lw);
    if (colors.length > 1) {
      drawConcentricSquares(ctx, cx + 3, cy + 3, size * 0.6, 12, disorderVal * 2, rng, colors[1], lw * 0.7);
    }
  } else if (composition === 3) {
    const units = 30 + Math.floor(rng() * 20);
    for (let i = 0; i < units; i++) {
      const cx = pad + rng() * drawW;
      const cy = pad + 20 + rng() * drawH;
      const size = 20 + rng() * 80;
      const layers = 4 + Math.floor(rng() * 10);
      const localDisorder = disorderVal * (0.3 + rng() * 2);
      const color = colors[Math.floor(rng() * colors.length)];
      drawConcentricSquares(ctx, cx, cy, size, layers, localDisorder, rng, color, lw * (0.5 + rng() * 0.8));
    }
  }

  ctx.fillStyle = "rgba(0,0,0,0.06)";
  ctx.font = '8px "Courier New", monospace';
  ctx.textAlign = "right";
  ctx.fillText("FORTRAN IV \u2014 BENSON PLOTTER \u2014 COMP. " + (composition + 1), w - 32, h - 8);
}

function updateUI() {
  document.getElementById("disorderVal").textContent = disorder + "%";
  document.getElementById("disorderSlider").value = disorder;
  document.getElementById("compTitle").textContent = "Machine Imaginaire \u2014 " + compNames[composition];
  document.getElementById("subline").textContent = "Algorithmic plotter drawing \u2014 " + disorder + "% disorder \u2014 Seed #" + seed;
  document.getElementById("animBtn").textContent = isAnimating ? "\u25FC Stop" : "\u25B6 Animate";
  document.getElementById("animBtn").style.background = isAnimating ? "#1a1a1a" : "transparent";
  document.getElementById("animBtn").style.color = isAnimating ? "#fff" : "rgba(0,0,0,0.4)";
  document.getElementById("plotterStamp").textContent = "FORTRAN IV / Benson Plotter";

  document.querySelectorAll(".comp-btn").forEach(function(btn, i) {
    btn.style.background = composition === i ? "#1a1a1a" : "transparent";
    btn.style.color = composition === i ? "#FAF8F3" : "rgba(0,0,0,0.35)";
    btn.style.borderColor = composition === i ? "#1a1a1a" : "rgba(0,0,0,0.1)";
  });
  document.querySelectorAll(".color-btn").forEach(function(btn, i) {
    var activeBgs = ["#1a1a1a", "#1a3a6a", "#8b2020"];
    btn.style.background = colorMode === i ? activeBgs[i] : "transparent";
    btn.style.color = colorMode === i ? "#FAF8F3" : "rgba(0,0,0,0.3)";
    btn.style.borderColor = colorMode === i ? "transparent" : "rgba(0,0,0,0.08)";
  });

  drawScene();
}

function animateDisorder() {
  if (isAnimating) {
    cancelAnimationFrame(animFrame);
    isAnimating = false;
    updateUI();
    return;
  }
  isAnimating = true;
  var startTime = null;
  var duration = 6000;
  function tick(now) {
    if (!startTime) startTime = now;
    var t = ((now - startTime) % duration) / duration;
    var val = Math.sin(t * Math.PI) * 100;
    disorder = Math.round(val);
    updateUI();
    animFrame = requestAnimationFrame(tick);
  }
  animFrame = requestAnimationFrame(tick);
}

function buildUI() {
  var root = document.getElementById("root");
  root.innerHTML = '<div style="width:100vw;height:100vh;background:#E8E6E0;display:flex;flex-direction:column;font-family:\'Courier New\',Courier,monospace;overflow:hidden">'
    + '<div style="padding:14px 28px 10px;display:flex;justify-content:space-between;align-items:flex-start;border-bottom:1px solid rgba(0,0,0,0.06);flex-shrink:0">'
      + '<div>'
        + '<div style="font-size:10px;letter-spacing:0.14em;color:rgba(0,0,0,0.3);text-transform:uppercase;margin-bottom:2px">After Vera Moln\u00e1r (1924\u20132023)</div>'
        + '<div id="compTitle" style="font-size:17px;font-weight:400;color:#1a1a1a;letter-spacing:0.02em"></div>'
        + '<div id="subline" style="font-size:10px;color:rgba(0,0,0,0.25);margin-top:2px"></div>'
      + '</div>'
      + '<div style="text-align:right"><div style="font-size:9px;color:rgba(0,0,0,0.2);line-height:1.5;font-style:italic;font-family:Georgia,serif">\u201CMy life is in squares, triangles, lines.<br>I am mad about lines.\u201D</div></div>'
    + '</div>'
    + '<div style="flex:1;padding:8px 16px;display:flex;align-items:center;justify-content:center">'
      + '<div style="width:100%;height:100%;max-width:900px;box-shadow:0 2px 20px rgba(0,0,0,0.06)">'
        + '<canvas id="mainCanvas" style="width:100%;height:100%;display:block"></canvas>'
      + '</div>'
    + '</div>'
    + '<div style="padding:10px 28px 14px;border-top:1px solid rgba(0,0,0,0.06);flex-shrink:0">'
      + '<div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">'
        + '<span style="font-size:10px;color:rgba(0,0,0,0.35);text-transform:uppercase;letter-spacing:0.1em;min-width:70px">Disorder</span>'
        + '<input type="range" id="disorderSlider" min="0" max="100" value="1" style="flex:1;max-width:300px;accent-color:#1a1a1a;height:2px">'
        + '<span id="disorderVal" style="font-size:11px;color:rgba(0,0,0,0.4);min-width:36px;text-align:right"></span>'
        + '<button id="animBtn" style="background:transparent;color:rgba(0,0,0,0.4);border:1px solid rgba(0,0,0,0.12);padding:4px 12px;font-size:10px;letter-spacing:0.06em;cursor:pointer;text-transform:uppercase;font-family:inherit"></button>'
      + '</div>'
      + '<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap" id="bottomControls"></div>'
    + '</div>'
  + '</div>';

  var bottom = document.getElementById("bottomControls");
  compNames.forEach(function(name, i) {
    var btn = document.createElement("button");
    btn.className = "comp-btn";
    btn.textContent = name;
    btn.style.cssText = "padding:5px 12px;font-size:9px;letter-spacing:0.04em;cursor:pointer;text-transform:uppercase;font-family:inherit;border:1px solid rgba(0,0,0,0.1)";
    btn.onclick = function() { composition = i; updateUI(); };
    bottom.appendChild(btn);
  });

  var sep1 = document.createElement("div");
  sep1.style.cssText = "width:1px;height:20px;background:rgba(0,0,0,0.06);margin:0 4px";
  bottom.appendChild(sep1);

  ["Black", "Blue Ink", "Red + Black"].forEach(function(label, i) {
    var btn = document.createElement("button");
    btn.className = "color-btn";
    btn.textContent = label;
    btn.style.cssText = "padding:5px 10px;font-size:9px;cursor:pointer;text-transform:uppercase;font-family:inherit;letter-spacing:0.04em;border:1px solid rgba(0,0,0,0.08)";
    btn.onclick = function() { colorMode = i; updateUI(); };
    bottom.appendChild(btn);
  });

  var sep2 = document.createElement("div");
  sep2.style.cssText = "width:1px;height:20px;background:rgba(0,0,0,0.06);margin:0 4px";
  bottom.appendChild(sep2);

  var seedBtn = document.createElement("button");
  seedBtn.textContent = "\u21BB New Seed";
  seedBtn.style.cssText = "background:transparent;color:rgba(0,0,0,0.35);border:1px solid rgba(0,0,0,0.1);padding:5px 14px;font-size:9px;cursor:pointer;text-transform:uppercase;font-family:inherit;letter-spacing:0.04em";
  seedBtn.onclick = function() { seed++; updateUI(); };
  bottom.appendChild(seedBtn);

  var spacer = document.createElement("div");
  spacer.style.flex = "1";
  bottom.appendChild(spacer);

  var stamp = document.createElement("span");
  stamp.id = "plotterStamp";
  stamp.style.cssText = "font-size:9px;color:rgba(0,0,0,0.15)";
  bottom.appendChild(stamp);

  document.getElementById("disorderSlider").addEventListener("input", function(e) {
    disorder = Number(e.target.value);
    updateUI();
  });
  document.getElementById("animBtn").addEventListener("click", animateDisorder);
  window.addEventListener("resize", drawScene);

  updateUI();
}

buildUI();
</script>
</body>
</html>
